# 🚀 HTML 调用 gRPC 快速启动指南

## 📋 前置要求

- ✅ Go 1.24 或更高版本
- ✅ 现代浏览器（Chrome、Firefox、Edge 等）

## ⚡ 快速开始（3步启动）

### 方法一：使用批处理文件（Windows 推荐）

1️⃣ **双击运行** `启动服务器.bat`
   - 这将启动 gRPC 服务器（端口 50051）
   - 保持此窗口打开

2️⃣ **双击运行** `web\启动网关.bat`
   - 这将启动 HTTP Gateway（端口 8080）
   - 保持此窗口打开

3️⃣ **打开浏览器** 访问 `http://localhost:8080/test.html`
   - 输入两个数字
   - 点击"计算"按钮
   - 查看结果！✨

### 方法二：使用命令行

**终端 1 - 启动 gRPC 服务器**
```bash
go run server/main.go
```

**终端 2 - 启动 HTTP Gateway**
```bash
go run web/gateway.go
```

**浏览器**
```
http://localhost:8080/test.html
```

## 🏗️ 架构说明

```
┌─────────────────────┐
│   浏览器 (HTML)     │
│   test.html         │
└──────────┬──────────┘
           │ HTTP POST
           │ JSON: {a: 10, b: 20}
           ↓
┌─────────────────────┐
│  HTTP Gateway       │
│  gateway.go         │
│  Port: 8080         │
└──────────┬──────────┘
           │ gRPC Call
           │ AddRequest {A: 10, B: 20}
           ↓
┌─────────────────────┐
│  gRPC Server        │
│  server/main.go     │
│  Port: 50051        │
└──────────┬──────────┘
           │ Calculate: 10 + 20
           │ AddResponse {Result: 30}
           ↓
┌─────────────────────┐
│  返回给浏览器        │
│  JSON: {result: 30} │
└─────────────────────┘
```

## 📁 核心文件说明

| 文件 | 作用 | 端口 |
|------|------|------|
| `server/main.go` | gRPC 服务器，处理计算逻辑 | 50051 |
| `web/gateway.go` | HTTP 网关，桥接浏览器和 gRPC | 8080 |
| `web/test.html` | 前端页面，提供用户界面 | - |
| `proto/calculator.proto` | gRPC 服务定义 | - |

## 🔍 测试流程

1. **在浏览器中输入数字**
   ```
   第一个数字: 10
   第二个数字: 20
   ```

2. **点击"计算"按钮**

3. **观察控制台输出**

   **gRPC 服务器** 控制台会显示：
   ```
   Server listening on :50051
   ```

   **HTTP Gateway** 控制台会显示：
   ```
   HTTP Gateway listening on :8080
   ```

   **浏览器** 会显示：
   ```
   10 + 20 = 30
   ```

4. **检查浏览器控制台** (F12)
   ```javascript
   gRPC 调用成功: {result: 30}
   ```

## 🔧 数据流示例

### 1. 浏览器发送请求

```javascript
fetch('http://localhost:8080/api/add', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({
        a: 10,
        b: 20
    })
})
```

### 2. Gateway 接收并转发

```go
// HTTP 请求 → gRPC 请求
grpcResp, err := grpcClient.Add(ctx, &proto.AddRequest{
    A: req.A,  // 10
    B: req.B,  // 20
})
```

### 3. gRPC 服务器处理

```go
func (s *calculatorServer) Add(ctx context.Context, req *proto.AddRequest) (*proto.AddResponse, error) {
    result := req.A + req.B  // 10 + 20 = 30
    return &proto.AddResponse{Result: result}, nil
}
```

### 4. 结果返回浏览器

```json
{
  "result": 30
}
```

## ⚠️ 常见问题

### Q1: 页面显示"调用失败"

**原因：** gRPC 服务器或 HTTP Gateway 未运行

**解决：**
```bash
# 检查服务器是否运行
# 应该看到两个 Go 进程分别监听 50051 和 8080 端口
```

### Q2: 端口被占用

**解决方法：**

修改 `server/main.go`:
```go
lis, err := net.Listen("tcp", ":50051")  // 改为其他端口，如 :50052
```

修改 `web/gateway.go`:
```go
conn, err := grpc.NewClient("localhost:50051", ...)  // 同步修改
http.ListenAndServe(":8080", nil)  // 改为其他端口，如 :8081
```

### Q3: 浏览器控制台显示 CORS 错误

**原因：** Gateway 的 CORS 配置问题

**解决：** 代码已经配置好 CORS，确保 Gateway 正常运行即可

### Q4: 显示"Cannot find package"

**解决：**
```bash
go mod tidy
go mod download
```

## 🎯 功能特性

✅ **美观的 UI 界面**
- 渐变背景
- 流畅动画
- 响应式设计

✅ **完善的错误处理**
- 输入验证
- 连接错误提示
- 友好的错误信息

✅ **良好的用户体验**
- Loading 状态
- 键盘快捷键（回车提交）
- 自动聚焦输入框

✅ **CORS 支持**
- 允许跨域访问
- 支持预检请求

## 📊 性能测试

你可以使用以下命令测试 API：

```bash
# 使用 curl 测试
curl -X POST http://localhost:8080/api/add \
  -H "Content-Type: application/json" \
  -d '{"a": 100, "b": 200}'

# 预期输出
# {"result":300}
```

## 🚀 扩展建议

1. **添加更多运算**
   - 减法、乘法、除法
   - 修改 proto 文件添加新方法

2. **添加历史记录**
   - localStorage 保存计算历史
   - 显示最近计算

3. **美化界面**
   - 添加动画效果
   - 主题切换

4. **添加认证**
   - JWT Token
   - API Key 验证

## 📖 相关文档

- [运行说明.md](./运行说明.md) - 详细的技术文档
- [proto/calculator.proto](./proto/calculator.proto) - gRPC 服务定义
- [README.md](./README.md) - 项目介绍

## 💡 提示

- 使用浏览器开发者工具（F12）查看网络请求
- 查看两个服务器的控制台输出了解运行状态
- 尝试输入不同的数字测试功能
- 查看 `web/test.html` 的源代码学习前端实现
- 查看 `web/gateway.go` 的源代码学习后端实现

## ✨ 测试清单

- [ ] gRPC 服务器成功启动
- [ ] HTTP Gateway 成功启动
- [ ] 浏览器能访问页面
- [ ] 输入数字并计算成功
- [ ] 结果正确显示
- [ ] 错误处理正常工作
- [ ] 键盘快捷键可用

---

🎉 **祝你使用愉快！如有问题，请查看详细的 [运行说明.md](./运行说明.md)**

